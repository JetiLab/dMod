% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/RcppExports.R
\name{nll_ALOQ_cpp}
\alias{nll_ALOQ_cpp}
\title{Non-linear log likelihood for the ALOQ part (C++ implementation)}
\usage{
nll_ALOQ_cpp(
  nout,
  derivs = NULL,
  derivs_err = NULL,
  opt_BLOQ = "M3",
  opt_hessian = logicalVector(),
  bessel_correction = 1,
  deriv2 = NULL,
  deriv2_err = NULL
)
}
\arguments{
\item{nout}{DataFrame from res/res_cpp, must contain:
\itemize{
\item weighted.residual (numeric) : wr (unscaled)
\item weighted.0       (numeric) : w0 (unscaled)
\item sigma            (numeric) : s
}}

\item{derivs}{NumericMatrix of first derivatives of prediction (NOT wr),
with columns corresponding to parameters only (no time/name columns).}

\item{derivs_err}{NumericMatrix of first derivatives of sigma,
same dimension as derivs (n_data Ã— n_pars) or NULL.}

\item{opt_BLOQ}{Character scalar, e.g. "M3", "M4NM", "M4BEAL", "M1".
Only "M4BEAL" changes the ALOQ contribution (extra Phi(w0) term).}

\item{opt_hessian}{Named LogicalVector controlling Hessian components
("ALOQ_part1", "ALOQ_part2", "ALOQ_part3") when 2nd derivatives are NOT supplied.}

\item{bessel_correction}{Numeric scalar. If != 1, weighted residuals
and w0 are multiplied by this factor (Bessel correction) for the
optimization objective. The TRUE ML (-2logL without Bessel) is stored
in the "neg2ll" attribute.}

\item{deriv2}{Optional 3D array (NumericVector with dim attribute)
of second derivatives of prediction: dim = c(n_data, n_pars, n_pars).}

\item{deriv2_err}{Optional 3D array of second derivatives of sigma,
same dims as deriv2.}
}
\value{
List with elements:
\itemize{
\item value    : corrected negative log-likelihood (for optimization)
\item gradient : numeric vector (or NULL) w.r.t parameters
\item hessian  : numeric matrix (or NULL)
Attributes:
\item "chisquare"       : TRUE chisquare (no Bessel correction)
\item "neg2ll"          : TRUE -2*log(L) (no Bessel, but with M4BEAL term if used)
\item "besselcorrected" : logical
}
}
\description{
Non-linear log likelihood for the ALOQ part (C++ implementation)
}
\details{
If deriv2 is NULL, the Hessian is computed using the same first-order
approximation as in the original R implementation, controlled by opt_hessian,
including the approximate M4BEAL Hessian block.

If deriv2 is NOT NULL, a full exact Hessian for the Gaussian ALOQ part
and for the M4BEAL ALOQ contribution is computed using the 2nd derivatives.
In that case, opt_hessian is ignored.
}
